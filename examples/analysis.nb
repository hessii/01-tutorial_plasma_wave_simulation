(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    263363,       6719]
NotebookOptionsPosition[    256644,       6622]
NotebookOutlinePosition[    257039,       6638]
CellTagsIndexPosition[    256996,       6635]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Import/Export", "Section",ExpressionUUID->"f035238d-a3d4-4d2c-96d0-0fa572842c23"],

Cell[CellGroupData[{

Cell["Import", "Subsection",ExpressionUUID->"e128867d-f81c-4723-a5f3-00f9a32a5b13"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "readMetadata", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"readMetadata", "[", "path__", "]"}], ":=", 
  RowBox[{"CompoundExpression", "[", 
   RowBox[{
    RowBox[{"Print", "[", "\"\<failed to read metadata\>\"", "]"}], ",", 
    RowBox[{"Throw", "[", 
     RowBox[{"Hold", "[", 
      RowBox[{"readMetadata", "[", "path", "]"}], "]"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"readMetadata", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{
     RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
     "\"\<csv\>\""}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"path", "=", "\"\<./moment-1.csv\>\""}], "*)"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"fd", ",", "meta"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fd", "=", 
        RowBox[{"OpenRead", "[", "path", "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"meta", "=", 
        RowBox[{"ReadLine", "[", "fd", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Close", "[", "fd", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Rule", "[", 
          RowBox[{"#", ",", 
           RowBox[{"ToExpression", "[", "#2", "]"}]}], "]"}], "&"}], "@@@", 
        RowBox[{"Map", "[", 
         RowBox[{"StringTrim", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"StringSplit", "[", 
             RowBox[{"#", ",", "\"\<=\>\""}], "]"}], "&"}], "/@", 
           RowBox[{"StringSplit", "[", 
            RowBox[{
             RowBox[{"meta", "~", "StringReplace", "~", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\"\<e-\>\"", "\[Rule]", "\"\<*^-\>\""}], ",", 
                RowBox[{"\"\<e+\>\"", "\[Rule]", "\"\<*^\>\""}]}], "}"}]}], 
             ",", "\"\<;\>\""}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"-", "1"}], "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellLabel->
  "(krnl1) In[57]:=",ExpressionUUID->"d78cce98-3a82-4785-85db-8be2519bd616"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importField", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{
     RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
     "\"\<csv\>\""}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"path", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
         "\"\<figure_1a-AhHe_1.5/PC_full_f_2\>\"", ",", 
          "\"\<field-50.h5\>\""}], "}"}], "]"}]}], "*)"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"path", ",", "\"\<CSV\>\"", ",", 
            RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "2"}]}], "]"}], "//", 
          "Transpose"}]}], ",", "dE", ",", "dB", ",", "meta"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dB", "=", 
        RowBox[{"Take", "[", 
         RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dE", "=", 
        RowBox[{"Drop", "[", 
         RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"meta", "=", 
        RowBox[{"readMetadata", "[", "path", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Association", "@", 
        RowBox[{"Join", "[", 
         RowBox[{"meta", ",", "\[IndentingNewLine]", 
          RowBox[{"Thread", "[", 
           RowBox[{"Rule", "[", 
            RowBox[{
             RowBox[{"StringJoin", "@@@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"\"\<dB\>\"", ",", 
                 RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
               "]"}]}], ",", "dB"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Thread", "[", 
           RowBox[{"Rule", "[", 
            RowBox[{
             RowBox[{"StringJoin", "@@@", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"\"\<dE\>\"", ",", 
                 RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
               "]"}]}], ",", "dE"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
         "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importField", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{
     RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
     "\"\<h5\>\""}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"path", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
         "\"\<figure_1a-AhHe_1.5/PC_full_f_2\>\"", ",", 
          "\"\<field-50.h5\>\""}], "}"}], "]"}]}], "*)"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"meta", ",", "dsets"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"meta", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", 
          RowBox[{"{", 
           RowBox[{
           "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "\"\</field\>\""}],
            "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\""}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Rule", "[", 
           RowBox[{
            RowBox[{"FileNameTake", "[", "#", "]"}], ",", 
            RowBox[{"Import", "[", 
             RowBox[{"path", ",", 
              RowBox[{"{", 
               RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", "#"}], 
               "}"}]}], "]"}]}], "]"}], "&"}], "/@", "dsets"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"meta", ",", "dsets"}], "}"}], ",", "Last"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 CellLabel->
  "(krnl1) In[60]:=",ExpressionUUID->"832b9a46-ac29-42bb-9d5f-ba56a5964cbf"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importMoment", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importMoment", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{
     RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
     "\"\<csv\>\""}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"NentryPerSpecies", "=", "7"}], 
     RowBox[{"(*", 
      RowBox[{",", 
       RowBox[{"path", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{
          "\"\<../tmp/smoothing_effect\>\"", ",", "identifier", ",", 
           "\"\<data\>\"", ",", "\"\<moment-20.csv\>\""}], "}"}], "]"}]}]}], 
      "*)"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"path", ",", "\"\<CSV\>\"", ",", 
            RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "2"}]}], "]"}], "//", 
          "Transpose"}]}], ",", "n", ",", "nV1", ",", "nV2", ",", "nV3", ",", 
        "nv1v1", ",", "nv2v2", ",", "nv3v3", ",", "meta"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", 
           RowBox[{"-", "1"}], ";;", "NentryPerSpecies"}], "]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nV1", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "1"}], ";;", "NentryPerSpecies"}], "]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nV2", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"3", ";;", 
           RowBox[{"-", "1"}], ";;", "NentryPerSpecies"}], "]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nV3", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"4", ";;", 
           RowBox[{"-", "1"}], ";;", "NentryPerSpecies"}], "]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nv1v1", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"5", ";;", 
           RowBox[{"-", "1"}], ";;", "NentryPerSpecies"}], "]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nv2v2", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"6", ";;", 
           RowBox[{"-", "1"}], ";;", "NentryPerSpecies"}], "]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nv3v3", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"7", ";;", 
           RowBox[{"-", "1"}], ";;", "NentryPerSpecies"}], "]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"meta", "=", 
        RowBox[{"readMetadata", "[", "path", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Association", "@", 
        RowBox[{"Join", "[", 
         RowBox[{"meta", ",", "\[IndentingNewLine]", 
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Rule", "[", 
              RowBox[{
               RowBox[{"\"\<sp\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"#2", "//", "First"}], "]"}], "<>", "\"\<n\>\""}], 
               ",", "#"}], "]"}], "&"}], ",", "n"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Rule", "[", 
              RowBox[{
               RowBox[{"\"\<sp\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"#2", "//", "Last"}], "]"}], "<>", "\"\<nV\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"#2", "//", "First"}], "]"}]}], ",", "#"}], "]"}], 
             "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"nV1", ",", "nV2", ",", "nV3"}], "}"}], ",", 
            RowBox[{"{", "2", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Rule", "[", 
              RowBox[{
               RowBox[{"\"\<sp\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"#2", "//", "Last"}], "]"}], "<>", "\"\<nv\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"#2", "//", "First"}], "]"}], "<>", "\"\<v\>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"#2", "//", "First"}], "]"}]}], ",", "#"}], "]"}], 
             "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"nv1v1", ",", "nv2v2", ",", "nv3v3"}], "}"}], ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
         "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importMoment", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{
     RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
     "\"\<h5\>\""}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"path", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
         "\"\<figure_1a-AhHe_1.5/PC_full_f_2\>\"", ",", 
          "\"\<moment-100.h5\>\""}], "}"}], "]"}]}], "*)"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"meta", ",", "dsets"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"meta", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", 
          RowBox[{"{", 
           RowBox[{
           "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
            "\"\</moment\>\""}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\""}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"data", ",", "ijk"}], "}"}], ",", 
              RowBox[{"Rule", "[", 
               RowBox[{
                RowBox[{"\"\<sp\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"First", "[", "ijk", "]"}], "]"}], "<>", 
                 RowBox[{"FileNameTake", "[", "#", "]"}]}], ",", "data"}], 
               "]"}]}], "]"}], ",", 
            RowBox[{"Import", "[", 
             RowBox[{"path", ",", 
              RowBox[{"{", 
               RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", "#"}], 
               "}"}]}], "]"}]}], "]"}], "&"}], "/@", "dsets"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"meta", ",", 
           RowBox[{"Sequence", "@@", "dsets"}]}], "}"}], ",", "Last"}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellLabel->
  "(krnl1) In[63]:=",ExpressionUUID->"984258eb-365b-4048-ab10-6220b1896c2a"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importParticles", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importParticles", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{"And", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
       "\"\<csv\>\""}], ",", 
      RowBox[{"StringMatchQ", "[", 
       RowBox[{
        RowBox[{"FileBaseName", "[", "path", "]"}], ",", 
        RowBox[{"\"\<particle-\>\"", "~~", "__"}]}], "]"}]}], "]"}]}], "]"}], 
  ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"path", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"\"\<./data\>\"", ",", "\"\<particle-sp_1-1.csv\>\""}], 
         "}"}], "]"}]}], "*)"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{"Import", "[", 
          RowBox[{"path", ",", "\"\<CSV\>\"", ",", 
           RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}]}], ",", 
        "keys"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"keys", "=", 
        RowBox[{"data", "//", "First"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{
         RowBox[{"data", "//", "Rest"}], "//", "Transpose"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Association", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"readMetadata", "[", "path", "]"}], ",", 
          RowBox[{"Thread", "[", 
           RowBox[{"Rule", "[", 
            RowBox[{"keys", ",", "data"}], "]"}], "]"}]}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"importParticles", "[", 
    RowBox[{
     RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
     RowBox[{"And", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
        "\"\<gz\>\""}], ",", 
       RowBox[{"StringMatchQ", "[", 
        RowBox[{
         RowBox[{"FileBaseName", "[", "path", "]"}], ",", 
         RowBox[{"\"\<particle-\>\"", "~~", "__"}]}], "]"}]}], "]"}]}], "]"}],
    ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"(*", 
       RowBox[{"path", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"\"\<./data\>\"", ",", "\"\<particle-sp_1-1.csv\>\""}], 
          "}"}], "]"}]}], "*)"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{"Import", "[", 
           RowBox[{"path", ",", "\"\<CSV\>\"", ",", 
            RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}]}], ",", 
         "keys"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"keys", "=", 
         RowBox[{"data", "//", "First"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{"data", "//", "Rest"}], "//", "Transpose"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{"Join", "[", 
          RowBox[{"Thread", "[", 
           RowBox[{"Rule", "[", 
            RowBox[{"keys", ",", "data"}], "]"}], "]"}], "]"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"importParticles", "[", 
     RowBox[{
      RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
      RowBox[{"And", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
         "\"\<h5\>\""}], ",", 
        RowBox[{"StringMatchQ", "[", 
         RowBox[{
          RowBox[{"FileBaseName", "[", "path", "]"}], ",", 
          RowBox[{"\"\<particle-\>\"", "~~", "__"}]}], "]"}]}], "]"}]}], 
     "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"(*", 
        RowBox[{"path", "=", 
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{"\"\<./data\>\"", ",", "\"\<particle-sp_1-1.h5\>\""}], 
           "}"}], "]"}]}], "*)"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"keys", "=", 
          RowBox[{"FileNameTake", "/@", 
           RowBox[{"Import", "[", 
            RowBox[{"path", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\""}], "}"}]}], 
            "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"Rule", "[", 
           RowBox[{"keys", ",", 
            RowBox[{"Import", "[", 
             RowBox[{"path", ",", 
              RowBox[{"{", 
               RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", "keys"}],
                "}"}]}], "]"}]}], "]"}], "]"}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importParticles", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{
     RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
     "\"\<h5\>\""}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"path", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
         "\"\<figure_1a-AhHe_1.5/PC_full_f_2\>\"", ",", 
          "\"\<particle-sp_5-10000.h5\>\""}], "}"}], "]"}]}], "*)"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"meta", ",", "dsets"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"meta", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", 
          RowBox[{"{", 
           RowBox[{
           "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
            "\"\</particle\>\""}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\""}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Rule", "[", 
           RowBox[{
            RowBox[{"FileNameTake", "[", "#", "]"}], ",", 
            RowBox[{"Import", "[", 
             RowBox[{"path", ",", 
              RowBox[{"{", 
               RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", "#"}], 
               "}"}]}], "]"}]}], "]"}], "&"}], "/@", "dsets"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"meta", ",", "dsets"}], "}"}], ",", "Last"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 CellLabel->
  "(krnl1) In[66]:=",ExpressionUUID->"9ed86c53-5481-4662-b095-0d009e616ab7"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importVHist2d", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importVHist2d", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{
     RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
     "\"\<csv\>\""}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"path", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
         "\"\<figure_1a-AhHe_1.5/PC_full_f_2\>\"", ",", 
          "\"\<vhist2d-sp_1-1000.csv\>\""}], "}"}], "]"}]}], "*)"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "meta", ",", "keys", ",", "vals", ",", "idxs", ",", "vhist", ",", 
        "whist"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vhist", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", "\"\<List\>\"", ",", 
          RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "2"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"meta", "=", 
        RowBox[{
         RowBox[{"readMetadata", "[", "path", "]"}], "//", "Association"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"vhist", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"StringReplace", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<e\>\"", "\[Rule]", "\"\<*^\>\""}], "}"}]}], "]"}], 
           "]"}], "&"}], "/@", "vhist"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"idxs", ",", "vhist"}], "}"}], "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"List", "@@@", "vhist"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"vhist", ",", "whist"}], "}"}], "=", 
        RowBox[{"vhist", "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{"meta", ",", "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"\"\<v1\>\"", "\[Rule]", 
              RowBox[{"MovingAverage", "[", 
               RowBox[{
                RowBox[{"Array", "[", 
                 RowBox[{"Identity", ",", 
                  RowBox[{
                   RowBox[{"meta", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}], "+", 
                   "1"}], ",", 
                  RowBox[{"meta", "[", "\"\<v1lim\>\"", "]"}]}], "]"}], ",", 
                "2"}], "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"\<v2\>\"", "\[Rule]", 
              RowBox[{"MovingAverage", "[", 
               RowBox[{
                RowBox[{"Array", "[", 
                 RowBox[{"Identity", ",", 
                  RowBox[{
                   RowBox[{"meta", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}], "+", 
                   "1"}], ",", 
                  RowBox[{"meta", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], ",", 
                "2"}], "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"\"\<vhist\>\"", "\[Rule]", 
                RowBox[{"Normal", "@", 
                 RowBox[{"SparseArray", "[", 
                  RowBox[{
                   RowBox[{"idxs", "\[Rule]", "vhist"}], ",", 
                   RowBox[{"meta", "[", "\"\<vdims\>\"", "]"}]}], "]"}]}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<whist\>\"", "\[Rule]", 
                RowBox[{"Normal", "@", 
                 RowBox[{"SparseArray", "[", 
                  RowBox[{
                   RowBox[{"idxs", "\[Rule]", "whist"}], ",", 
                   RowBox[{"meta", "[", "\"\<vdims\>\"", "]"}]}], "]"}]}]}]}],
               "\[IndentingNewLine]", "}"}], ","}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"\"\<vhist\>\"", "\[Rule]", "vhist"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"\"\<whist\>\"", "\[Rule]", "whist"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"\"\<idxs\>\"", "\[Rule]", "idxs"}]}], 
            "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}], ",",
          "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importVHist2d", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{
     RowBox[{"FileExtension", "[", "path", "]"}], "\[Equal]", 
     "\"\<h5\>\""}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"path", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
         "\"\<figure_1a-AhHe_1.5/PC_full_f_2\>\"", ",", 
          "\"\<vhist2d-sp_1-1000.h5\>\""}], "}"}], "]"}]}], "*)"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"meta", ",", "dsets"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"meta", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", 
          RowBox[{"{", 
           RowBox[{
           "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
            "\"\</vhist2d\>\""}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\""}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Rule", "[", 
           RowBox[{
            RowBox[{"FileNameTake", "[", "#", "]"}], ",", 
            RowBox[{"Import", "[", 
             RowBox[{"path", ",", 
              RowBox[{"{", 
               RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", "#"}], 
               "}"}]}], "]"}]}], "]"}], "&"}], "/@", "dsets"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"meta", ",", "dsets"}], "}"}], ",", "Last"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 CellLabel->
  "(krnl1) In[70]:=",ExpressionUUID->"f67f68d7-f19f-4adc-856d-65cc92e39e1f"]
}, Closed]],

Cell[CellGroupData[{

Cell["Export", "Subsection",ExpressionUUID->"8ea02f9c-9d0e-41fa-8e9e-85bc94c2bc74"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "exportToHDF5", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"exportToHDF5", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{"StringMatchQ", "[", 
     RowBox[{
      RowBox[{"FileBaseName", "[", "path", "]"}], ",", 
      RowBox[{"\"\<field-\>\"", "~~", "__"}]}], "]"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"path", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"wd", ",", "\"\<field-50.csv\>\""}], "}"}], "]"}]}], ","}], 
      "*)"}], 
     RowBox[{"dsets", "=", 
      RowBox[{"{", 
       RowBox[{
       "\"\<dB1\>\"", ",", "\"\<dB2\>\"", ",", "\"\<dB3\>\"", ",", 
        "\"\<dE1\>\"", ",", "\"\<dE2\>\"", ",", "\"\<dE3\>\""}], "}"}]}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{"importField", "[", "path", "]"}]}], ",", "attrs"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"attrs", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{"data", ",", "dsets"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"KeyTake", "[", 
          RowBox[{"data", ",", "dsets"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"DirectoryName", "[", "path", "]"}], ",", 
            RowBox[{
             RowBox[{"FileBaseName", "[", "path", "]"}], "<>", 
             "\"\<.h5\>\""}]}], "}"}], "]"}], ",", 
         RowBox[{"\[LeftAssociation]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\"\<Groups\>\"", "\[Rule]", "\"\</field\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Attributes\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\</field\>\"", "\[Rule]", "attrs"}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Datasets\>\"", "\[Rule]", 
            RowBox[{"ReplaceAll", "[", 
             RowBox[{"data", ",", 
              RowBox[{"$_String", "\[RuleDelayed]", 
               RowBox[{"\"\</field/\>\"", "<>", "$"}]}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "\[RightAssociation]"}], ",", 
         "\"\<Rules\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"exportToHDF5", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{"StringMatchQ", "[", 
     RowBox[{
      RowBox[{"FileBaseName", "[", "path", "]"}], ",", 
      RowBox[{"\"\<moment-\>\"", "~~", "__"}]}], "]"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"path", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"wd", ",", "\"\<moment-100.csv\>\""}], "}"}], "]"}]}], 
      "*)"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{"importMoment", "[", "path", "]"}]}], ",", "dsets", ",", 
        "attrs"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dsets", "=", 
        RowBox[{"Keys", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{"Cases", "[", 
         RowBox[{"dsets", ",", 
          RowBox[{"$_String", "/;", 
           RowBox[{"StringMatchQ", "[", 
            RowBox[{"$", ",", 
             RowBox[{"\"\<sp\>\"", "~~", 
              RowBox[{"DigitCharacter", ".."}], "~~", "__"}]}], "]"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"attrs", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{"data", ",", "dsets"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"KeyTake", "[", 
          RowBox[{"data", ",", "dsets"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Rule", "[", 
           RowBox[{
            RowBox[{"\"\</moment/\>\"", "<>", "#"}], ",", 
            RowBox[{"Replace", "[", 
             RowBox[{
              RowBox[{"StringJoin", "@@@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<sp\>\"", ",", 
                  RowBox[{"ToString", "/@", 
                   RowBox[{"Range", "[", 
                    RowBox[{"\"\<Ns\>\"", "/.", "attrs"}], "]"}]}], ",", 
                  "#"}], "}"}], "]"}]}], ",", "data", ",", 
              RowBox[{"{", "1", "}"}]}], "]"}]}], "]"}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{
          "\"\<n\>\"", ",", "\"\<nV1\>\"", ",", "\"\<nV2\>\"", ",", 
           "\"\<nV3\>\"", ",", "\"\<nv1v1\>\"", ",", "\"\<nv2v2\>\"", ",", 
           "\"\<nv3v3\>\""}], "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"DirectoryName", "[", "path", "]"}], ",", 
            RowBox[{
             RowBox[{"FileBaseName", "[", "path", "]"}], "<>", 
             "\"\<.h5\>\""}]}], "}"}], "]"}], ",", 
         RowBox[{"\[LeftAssociation]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\"\<Groups\>\"", "\[Rule]", "\"\</moment\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Attributes\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\</moment\>\"", "\[Rule]", "attrs"}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Datasets\>\"", "\[Rule]", "data"}]}], 
          "\[IndentingNewLine]", "\[RightAssociation]"}], ",", 
         "\"\<Rules\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"exportToHDF5", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{"StringMatchQ", "[", 
     RowBox[{
      RowBox[{"FileBaseName", "[", "path", "]"}], ",", 
      RowBox[{"\"\<particle-sp_\>\"", "~~", "__"}]}], "]"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"path", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"wd", ",", "\"\<particle-sp_5-5000.csv\>\""}], "}"}], 
         "]"}]}], ","}], "*)"}], 
     RowBox[{"dsets", "=", 
      RowBox[{"{", 
       RowBox[{
       "\"\<v1\>\"", ",", "\"\<v2\>\"", ",", "\"\<v3\>\"", ",", "\"\<x\>\"", 
        ",", "\"\<w\>\""}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{"importParticles", "[", "path", "]"}]}], ",", "attrs"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"attrs", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{"data", ",", "dsets"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"KeyTake", "[", 
          RowBox[{"data", ",", "dsets"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"DirectoryName", "[", "path", "]"}], ",", 
            RowBox[{
             RowBox[{"FileBaseName", "[", "path", "]"}], "<>", 
             "\"\<.h5\>\""}]}], "}"}], "]"}], ",", 
         RowBox[{"\[LeftAssociation]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\"\<Groups\>\"", "\[Rule]", "\"\</particle\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Attributes\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\</particle\>\"", "\[Rule]", "attrs"}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Datasets\>\"", "\[Rule]", 
            RowBox[{"ReplaceAll", "[", 
             RowBox[{"data", ",", 
              RowBox[{"$_String", "\[RuleDelayed]", 
               RowBox[{"\"\</particle/\>\"", "<>", "$"}]}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "\[RightAssociation]"}], ",", 
         "\"\<Rules\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"exportToHDF5", "[", 
   RowBox[{
    RowBox[{"path_String", "?", "FileExistsQ"}], "/;", 
    RowBox[{"StringMatchQ", "[", 
     RowBox[{
      RowBox[{"FileBaseName", "[", "path", "]"}], ",", 
      RowBox[{"\"\<vhist2d-sp_\>\"", "~~", "__"}]}], "]"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"path", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"wd", ",", "\"\<vhist2d-sp_1-1000.csv\>\""}], "}"}], 
         "]"}]}], ","}], "*)"}], 
     RowBox[{"dsets", "=", 
      RowBox[{"{", 
       RowBox[{"\"\<vhist\>\"", ",", "\"\<whist\>\"", ",", "\"\<idxs\>\""}], 
       "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{"importVHist2d", "[", "path", "]"}]}], ",", "attrs"}], "}"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"attrs", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{"data", ",", "dsets"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"KeyTake", "[", 
          RowBox[{"data", ",", "dsets"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"DirectoryName", "[", "path", "]"}], ",", 
            RowBox[{
             RowBox[{"FileBaseName", "[", "path", "]"}], "<>", 
             "\"\<.h5\>\""}]}], "}"}], "]"}], ",", 
         RowBox[{"\[LeftAssociation]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\"\<Groups\>\"", "\[Rule]", "\"\</vhist2d\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Attributes\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\</vhist2d\>\"", "\[Rule]", "attrs"}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Datasets\>\"", "\[Rule]", 
            RowBox[{"ReplaceAll", "[", 
             RowBox[{"data", ",", 
              RowBox[{"$_String", "\[RuleDelayed]", 
               RowBox[{"\"\</vhist2d/\>\"", "<>", "$"}]}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "\[RightAssociation]"}], ",", 
         "\"\<Rules\>\""}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellLabel->
  "(krnl1) In[73]:=",ExpressionUUID->"6c2a0e21-e5ea-4d3b-9332-3fc1d7a2734a"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Analysis", "Section",ExpressionUUID->"a49cfbcd-1345-45bc-a353-15faed1a68e3"],

Cell[BoxData[
 RowBox[{"wd", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"demo", "=", "\"\</Users/kyungguk/Downloads/Test1/data\>\""}], 
     "}"}], ",", "\[IndentingNewLine]", "demo"}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellLabel->
  "(krnl1) In[78]:=",ExpressionUUID->"4a819e33-64b4-484a-bf21-d831b367a6e4"],

Cell[CellGroupData[{

Cell["Energy", "Subsection",ExpressionUUID->"83125ca6-ce33-438f-8af7-0792b1533a0a"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"wd", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"demo", "=", "\"\<0_control/data\>\""}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<.\>\"", ",", "demo"}], "}"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], "*)"}]], "Input",
 CellLabel->
  "(krnl1) In[86]:=",ExpressionUUID->"608f2eae-8bf8-46fb-8f5e-f9604c81d58a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "6"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
         "mU2O2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "(krnl1) In[87]:=",ExpressionUUID->"0a3b8942-02d9-4e97-b7a4-fde7759b5922"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "(krnl1) In[88]:=",ExpressionUUID->"7cb0b11d-5057-4184-96b5-71e03da3d996"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "(krnl1) In[89]:=",ExpressionUUID->"b09a43c0-ee69-41ea-9af1-337d08b98870"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "(krnl1) In[90]:=",ExpressionUUID->"d91caf77-0cde-4350-bdc1-36afcbcbc488"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "(krnl1) In[91]:=",ExpressionUUID->"61d0a445-f7fd-40bd-a08d-4749f3a3b19a"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{"m\[Theta]2O2", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T2", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "(krnl1) In[92]:=",ExpressionUUID->"55deacc0-898f-4621-8934-8d58830930c0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsection",ExpressionUUID->"4ef98a16-4706-471c-ab3d-9c94ac395b4b"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"wd", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"demo", "=", "\"\<0_control/data\>\""}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<.\>\"", ",", "demo"}], "}"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], "*)"}]], "Input",
 CellLabel->
  "In[1724]:=",ExpressionUUID->"6eb39148-092a-4364-9cb4-6de587274b53"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"paths", "=", 
       RowBox[{"SortBy", "[", 
        RowBox[{
         RowBox[{"FileNames", "[", 
          RowBox[{"\"\<field-*\>\"", ",", "wd"}], "]"}], ",", 
         RowBox[{"Function", "[", 
          RowBox[{"path", ",", "\[IndentingNewLine]", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"s", "=", 
               RowBox[{"FileNameTake", "[", "path", "]"}]}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"StringCases", "[", 
              RowBox[{"s", ",", 
               RowBox[{
                RowBox[{"\"\<-\>\"", "~~", 
                 RowBox[{"i", ":", "NumberString"}], "~~", "\"\<.\>\"", "~~", 
                 "__"}], "\[RuleDelayed]", 
                RowBox[{"ToExpression", "[", "i", "]"}]}]}], "]"}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
        "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"importField", "[", "paths", "]"}], "]"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"assoc", "[", "\"\<Dx\>\"", "]"}], "=", 
         RowBox[{
          RowBox[{"assoc", "[", "\"\<Dx\>\"", "]"}], "//", "First"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"assoc", "[", "\"\<Nx\>\"", "]"}], "=", 
         RowBox[{
          RowBox[{"assoc", "[", "\"\<Nx\>\"", "]"}], "//", "First"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"assoc", "[", "\"\<pos\>\"", "]"}], "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"assoc", "[", "\"\<Nx\>\"", "]"}], "]"}], 
          RowBox[{"assoc", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", "assoc"}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "(krnl1) In[30]:=",ExpressionUUID->"50a9efda-d764-4a41-82a5-3c129608138d"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "(krnl1) In[31]:=",ExpressionUUID->"eebd8508-0302-44e4-af48-83820ff9683f"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"scale", "=", "1.5"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"0", "+", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], ",", 
     RowBox[{"tspan", "=", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}], ",", "2"}], "]"}]}], ",", 
     RowBox[{"xspan", "=", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}], ",", "1"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "xlim", ",", "t", ",", "post", ",", "dB2", ",", "dB3", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xlim", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"field", "[", "\"\<Nx\>\"", "]"}]}], "}"}], 
        RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[Equal]", "0"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<invalid tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{
        RowBox[{"post", "[", "t", "]"}], "[", 
        RowBox[{"[", "tspan", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{"Part", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"field", "[", "\"\<dB2\>\"", "]"}], "//", "post"}], ",", 
         "tspan", ",", "xspan"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{"Part", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"field", "[", "\"\<dB3\>\"", "]"}], "//", "post"}], ",", 
         "tspan", ",", "xspan"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", 
         RowBox[{"{", 
          RowBox[{"dB2", ",", "dB3"}], "}"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"dB2", "*", 
           RowBox[{"scale", "/", "max"}]}], "+", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"dB3", "*", 
           RowBox[{"scale", "/", "max"}]}], "+", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<time\>\""}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{"xlim", ",", 
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotLabel", "\[Rule]", "\"\<dB_y\>\""}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{"xlim", ",", 
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotLabel", "\[Rule]", "\"\<dB_z\>\""}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<TemperatureMap\>\"", ",", 
              RowBox[{
               RowBox[{"max", "/", "scale"}], 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Bottom"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[2207]:=",ExpressionUUID->"bd63cbba-380a-4865-a0ec-2d81e9ecb862"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"scale", "=", "1.5"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"tspan", "=", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}], ",", "2"}], "]"}]}], ",", 
     RowBox[{"xspan", "=", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}], ",", "1"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "xlim", ",", "t", ",", "post", ",", "dB1", ",", "dB2", ",", "dB3", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xlim", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"field", "[", "\"\<Nx\>\"", "]"}]}], "}"}], 
        RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[Equal]", "0"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<invalid tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{
        RowBox[{"post", "[", "t", "]"}], "[", 
        RowBox[{"[", "tspan", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{"Part", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"field", "[", "\"\<dE1\>\"", "]"}], "//", "post"}], ",", 
         "tspan", ",", "xspan"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{"Part", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"field", "[", "\"\<dE2\>\"", "]"}], "//", "post"}], ",", 
         "tspan", ",", "xspan"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{"Part", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"field", "[", "\"\<dE3\>\"", "]"}], "//", "post"}], ",", 
         "tspan", ",", "xspan"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", 
         RowBox[{"{", 
          RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "}"}], "]"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"dB1", "*", 
           RowBox[{"scale", "/", 
            RowBox[{"Max", "[", 
             RowBox[{"Abs", "[", "dB1", "]"}], "]"}]}]}], "+", "1"}], 
         ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"dB2", "*", 
           RowBox[{"scale", "/", "max"}]}], "+", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"dB3", "*", 
           RowBox[{"scale", "/", "max"}]}], "+", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", "3"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<time\>\""}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{"xlim", ",", 
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotLabel", "\[Rule]", "\"\<dE_x\>\""}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{"xlim", ",", 
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotLabel", "\[Rule]", "\"\<dE_y\>\""}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{"xlim", ",", 
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotLabel", "\[Rule]", "\"\<dE_z\>\""}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<TemperatureMap\>\"", ",", 
              RowBox[{
               RowBox[{"max", "/", "scale"}], 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Bottom"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",ExpressionUUID->"332560ff-2177-4a1b-\
9c52-0e47523d1abf"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "5"}], ",", 
     RowBox[{"decade", "=", "5"}], ",", 
     RowBox[{"tsmooth", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "dB3", ",", "dB2", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[Equal]", "0"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"posk", "@", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"Abs", "@", 
               RowBox[{"Fourier", "[", "#", "]"}]}], ",", "2"}], "]"}]}], 
           "&"}], ",", 
          RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}], "]"}], "//", 
        "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"posk", "@", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"Abs", "@", 
               RowBox[{"Fourier", "[", "#", "]"}]}], ",", "2"}], "]"}]}], 
           "&"}], ",", 
          RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}], "]"}], "//", 
        "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"t", ",", "tsmooth", ",", 
          RowBox[{
           RowBox[{"tsmooth", "/", "2"}], "//", "Ceiling"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"dB3", ",", "tsmooth", ",", 
          RowBox[{
           RowBox[{"tsmooth", "/", "2"}], "//", "Ceiling"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"dB2", ",", "tsmooth", ",", 
          RowBox[{
           RowBox[{"tsmooth", "/", "2"}], "//", "Ceiling"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{"dB3", "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{"dB2", "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"t", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"dB2", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\"", ",", 
               "None"}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".02", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"dB3", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\"", ",", 
               "\"\<\\!\\(t\[VeryThinSpace]\!\(\*SubscriptBox[\(\
\[CapitalOmega]\), \(p\)]\)\\)\>\""}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".02", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Column", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"10", ",", "180"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}]}], "]"}], ",", 
          "Right"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1802]:=",ExpressionUUID->"59e6d83f-a7fd-4e5a-a6ee-75425b33a3af"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"800", "+", 
       RowBox[{"200", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}]}]}], ",", 
     RowBox[{"kmax", "=", "5"}], ",", 
     RowBox[{"\[Omega]max", "=", "2"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"FrameLabel", "->", 
               RowBox[{"{", 
                RowBox[{
                "None", ",", 
                 "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
                "}"}]}], ","}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "None", ",", 
               "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], "}"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Labeled", "[", 
       RowBox[{
        RowBox[{"Legended", "[", 
         RowBox[{
          RowBox[{"Column", "[", "plots", "]"}], ",", 
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"BarLegend", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<Rainbow\>\"", ",", 
                RowBox[{"max", "+", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
              RowBox[{"LegendMarkerSize", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"180", ",", "10"}], "}"}]}], ",", 
              RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
              RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], 
            ",", "Above"}], "]"}]}], "]"}], ",", 
        RowBox[{"Text", "/@", 
         RowBox[{
         "{", "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", "}"}]}], ",", 
        RowBox[{"{", "Left", "}"}], ",", 
        RowBox[{"RotateLabel", "\[Rule]", "True"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "(krnl1) In[32]:=",ExpressionUUID->"d92d7554-db5f-46aa-852f-7cf228ebb7c6"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "2.1"}], ",", 
     RowBox[{"decade", "=", "8"}], ",", 
     RowBox[{"tsmooth", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "dB3", ",", "dB2", ",", 
       "dB1", ",", "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[Equal]", "0"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"posk", "@", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"Abs", "@", 
               RowBox[{"Fourier", "[", "#", "]"}]}], ",", "2"}], "]"}]}], 
           "&"}], ",", 
          RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}], "]"}], "//", 
        "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"posk", "@", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"Abs", "@", 
               RowBox[{"Fourier", "[", "#", "]"}]}], ",", "2"}], "]"}]}], 
           "&"}], ",", 
          RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}], "]"}], "//", 
        "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"posk", "@", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"Abs", "@", 
               RowBox[{"Fourier", "[", "#", "]"}]}], ",", "2"}], "]"}]}], 
           "&"}], ",", 
          RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}], "]"}], "//", 
        "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"t", ",", "tsmooth", ",", 
          RowBox[{
           RowBox[{"tsmooth", "/", "2"}], "//", "Ceiling"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"dB3", ",", "tsmooth", ",", 
          RowBox[{
           RowBox[{"tsmooth", "/", "2"}], "//", "Ceiling"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"dB2", ",", "tsmooth", ",", 
          RowBox[{
           RowBox[{"tsmooth", "/", "2"}], "//", "Ceiling"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"dB1", ",", "tsmooth", ",", 
          RowBox[{
           RowBox[{"tsmooth", "/", "2"}], "//", "Ceiling"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{"dB3", "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{"dB2", "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{"dB1", "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"t", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"dB1", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\"", ",", 
               "None"}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".02", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"dB2", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\"", ",", 
               "None"}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".02", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"dB3", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\"", ",", 
               "\"\<\\!\\(t\[VeryThinSpace]\!\(\*SubscriptBox[\(\
\[CapitalOmega]\), \(p\)]\)\\)\>\""}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".02", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Column", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"10", ",", "180"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}]}], "]"}], ",", 
          "Right"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[84]:=",ExpressionUUID->"478b6824-841d-4677-9d3e-33106e4328d1"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"800", "+", 
       RowBox[{"200", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}]}]}], ",", 
     RowBox[{"kmax", "=", "5"}], ",", 
     RowBox[{"\[Omega]max", "=", "2"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"FrameLabel", "->", 
               RowBox[{"{", 
                RowBox[{
                "None", ",", 
                 "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
                "}"}]}], ","}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"FrameLabel", "->", 
               RowBox[{"{", 
                RowBox[{
                "None", ",", 
                 "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
                "}"}]}], ","}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "None", ",", 
               "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], "}"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Labeled", "[", 
       RowBox[{
        RowBox[{"Legended", "[", 
         RowBox[{
          RowBox[{"Column", "[", "plots", "]"}], ",", 
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"BarLegend", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<Rainbow\>\"", ",", 
                RowBox[{"max", "+", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
              RowBox[{"LegendMarkerSize", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"180", ",", "10"}], "}"}]}], ",", 
              RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
              RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], 
            ",", "Above"}], "]"}]}], "]"}], ",", 
        RowBox[{"Text", "/@", 
         RowBox[{
         "{", "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", "}"}]}], ",", 
        RowBox[{"{", "Left", "}"}], ",", 
        RowBox[{"RotateLabel", "\[Rule]", "True"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "(krnl1) In[33]:=",ExpressionUUID->"16b8b2f9-aaad-4475-989d-1bd4692e16ce"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsection",ExpressionUUID->"a19fc9ee-9563-4a89-8372-606547c33870"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"wd", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"demo", "=", "\"\<0_control/data\>\""}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<.\>\"", ",", "demo"}], "}"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], "*)"}]], "Input",ExpressionUUID->\
"aab4b06c-a43c-47ae-af60-fdff533f24b2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"paths", "=", 
       RowBox[{"SortBy", "[", 
        RowBox[{
         RowBox[{"FileNames", "[", 
          RowBox[{"\"\<moment-*\>\"", ",", "wd"}], "]"}], ",", 
         RowBox[{"Function", "[", 
          RowBox[{"path", ",", "\[IndentingNewLine]", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"s", "=", 
               RowBox[{"FileNameTake", "[", "path", "]"}]}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"StringCases", "[", 
              RowBox[{"s", ",", 
               RowBox[{
                RowBox[{"\"\<-\>\"", "~~", 
                 RowBox[{"i", ":", "NumberString"}], "~~", "\"\<.\>\""}], 
                "\[RuleDelayed]", 
                RowBox[{"ToExpression", "[", "i", "]"}]}]}], "]"}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
        "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"importMoment", "[", "paths", "]"}], "]"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"assoc", "[", "\"\<Dx\>\"", "]"}], "=", 
         RowBox[{
          RowBox[{"assoc", "[", "\"\<Dx\>\"", "]"}], "//", "First"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"assoc", "[", "\"\<Nx\>\"", "]"}], "=", 
         RowBox[{
          RowBox[{"assoc", "[", "\"\<Nx\>\"", "]"}], "//", "First"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"assoc", "[", "\"\<pos\>\"", "]"}], "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"assoc", "[", "\"\<Nx\>\"", "]"}], "]"}], 
          RowBox[{"assoc", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", "assoc"}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "(krnl1) In[34]:=",ExpressionUUID->"f9f80f51-587f-4373-b747-ae91f24982c4"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "(krnl1) In[35]:=",ExpressionUUID->"09442f77-de8b-4de7-840e-c972682d3590"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"moment", "=", "moment"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"moment", "[", "\"\<time\>\"", "]"}], ",", "#"}], 
         RowBox[{"(*", 
          RowBox[{"-", 
           RowBox[{"moment", "[", "\"\<Nx\>\"", "]"}]}], "*)"}], "}"}], "]"}],
        "&"}], "/@", 
      RowBox[{"Map", "[", 
       RowBox[{"Total", ",", 
        RowBox[{"moment", "[", 
         RowBox[{"[", 
          RowBox[{"{", 
           RowBox[{"\"\<sp1n\>\"", ",", "\"\<sp2n\>\"", ",", "\"\<sp3n\>\""}],
            "}"}], "]"}], "]"}], ",", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"Joined", "\[Rule]", "True"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "(krnl1) In[36]:=",ExpressionUUID->"e187fb82-54ee-49be-b2a1-35d20794faab"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"moment", "=", "moment"}], ",", 
     RowBox[{"sp", "=", "3"}], ",", 
     RowBox[{"scale", "=", "1.5"}], ",", 
     RowBox[{"tspan", "=", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}], ",", "2"}], "]"}]}], ",", 
     RowBox[{"xspan", "=", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}], ",", "1"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "xlim", ",", "tlim", ",", "\[Delta]n", ",", "max", ",", "plots"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xlim", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"moment", "[", "\"\<Nx\>\"", "]"}]}], "}"}], 
        RowBox[{"moment", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tlim", "=", 
       RowBox[{"moment", "[", 
        RowBox[{"[", 
         RowBox[{"\"\<time\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]n", "=", 
       RowBox[{"1", "-", 
        RowBox[{"Part", "[", 
         RowBox[{
          RowBox[{"moment", "[", 
           RowBox[{"\"\<sp\>\"", "<>", 
            RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<n\>\""}], "]"}], 
          ",", "tspan", ",", "xspan"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "\[Delta]n", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]n", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"\[Delta]n", "*", 
           RowBox[{"scale", "/", "max"}]}], "+", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<time\>\""}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"\[Delta]n", "//", "Reverse"}], ",", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{"xlim", ",", "tlim"}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
           "PlotLabel", "\[Rule]", 
            "\"\<1-\[LeftAngleBracket]1\[RightAngleBracket]\>\""}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Column", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<TemperatureMap\>\"", ",", 
              RowBox[{
               RowBox[{"max", "/", "scale"}], 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Bottom"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "(krnl1) In[48]:=",ExpressionUUID->"66975706-fb8d-4dee-bc90-2ffbf6834ff3"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"moment", "=", "moment"}], ",", 
     RowBox[{"sp", "=", "2"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "5"}], ",", 
     RowBox[{"decade", "=", "5"}], ",", 
     RowBox[{"tsmooth", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Delta]n", ",", "max", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"moment", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[Equal]", "0"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"moment", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"moment", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]n", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"posk", "@", 
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Abs", "@", 
              RowBox[{"Fourier", "[", "#", "]"}]}], ",", "2"}], "]"}]}], 
          "&"}], ",", 
         RowBox[{
          RowBox[{"moment", "[", 
           RowBox[{"\"\<sp\>\"", "<>", 
            RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<n\>\""}], "]"}], 
          "//", "post"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"t", ",", "tsmooth", ",", 
          RowBox[{
           RowBox[{"tsmooth", "/", "2"}], "//", "Ceiling"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"\[Delta]n", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"\[Delta]n", ",", "tsmooth", ",", 
          RowBox[{
           RowBox[{"tsmooth", "/", "2"}], "//", "Ceiling"}]}], "]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"\[Delta]n", "=", 
       RowBox[{"\[Delta]n", "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "\[Delta]n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Delta]n", "-", "max"}], ")"}], "/", "decade"}], "+", 
        "1"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"t", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Delta]n", "\[Transpose]"}], "//", "Reverse"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\"", ",", 
              "\"\<\\!\\(t\[VeryThinSpace]\!\(\*SubscriptBox[\(\[CapitalOmega]\
\), \(p\)]\)\\)\>\""}], "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<|\!\(\*SuperscriptBox[\(\[Delta]n\), \(2\)]\)|\>\"", ",", 
                
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".02", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Column", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"10", ",", "180"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}]}], "]"}], ",", 
          "Right"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "(krnl1) In[40]:=",ExpressionUUID->"e0ea9c68-ce15-4aef-bada-23245c09d199"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"sp", "=", "3"}], ",", 
     RowBox[{"kmax", "=", "5"}], ",", 
     RowBox[{"\[Omega]max", "=", "2"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "kx", ",", "posk", ",", "\[Omega]t", ",", "pos\[Omega]", ",", "w", ",", 
       "n", ",", "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"field", "[", "\"\<time\>\"", "]"}], "//", "Length"}], ",", 
         
         RowBox[{"Subtract", "@@", 
          RowBox[{"field", "[", 
           RowBox[{"[", 
            RowBox[{"\"\<time\>\"", ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "1"}], "}"}]}], "]"}], "]"}]}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"HannWindow", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "#", "]"}], "]"}], "/", 
            RowBox[{"Length", "[", "#", "]"}]}], "-", ".5"}], "]"}], "&"}], 
        "@", 
        RowBox[{"field", "[", "\"\<time\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"field", "[", 
                RowBox[{"\"\<sp\>\"", "<>", 
                 RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<n\>\""}], 
                "]"}]}], "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(e\)]\)\>\
\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_e\\)\>\""}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".95", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Column", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"10", ",", "180"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}]}], "]"}], ",", 
          "Right"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "(krnl1) In[42]:=",ExpressionUUID->"24b490b0-8124-4917-ae2a-20b2efed7b51"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"moment", "=", "moment"}], ",", 
     RowBox[{"sp", "=", "3"}], ",", 
     RowBox[{"scale", "=", "1.5"}], ",", 
     RowBox[{"tspan", "=", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}], ",", "2"}], "]"}]}], ",", 
     RowBox[{"xspan", "=", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}], ",", "1"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "xlim", ",", "tlim", ",", "n", ",", "nV1", ",", "nV2", ",", "nV3", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xlim", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"moment", "[", "\"\<Nx\>\"", "]"}]}], "}"}], 
        RowBox[{"moment", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tlim", "=", 
       RowBox[{"moment", "[", 
        RowBox[{"[", 
         RowBox[{"\"\<time\>\"", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{"Part", "[", 
        RowBox[{
         RowBox[{"moment", "[", 
          RowBox[{"\"\<sp\>\"", "<>", 
           RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<n\>\""}], "]"}], 
         ",", "tspan", ",", "xspan"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nV1", "=", 
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{
          RowBox[{"moment", "[", 
           RowBox[{"\"\<sp\>\"", "<>", 
            RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<nV1\>\""}], 
           "]"}], ",", "tspan", ",", "xspan"}], "]"}], "/", "n"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nV2", "=", 
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{
          RowBox[{"moment", "[", 
           RowBox[{"\"\<sp\>\"", "<>", 
            RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<nV2\>\""}], 
           "]"}], ",", "tspan", ",", "xspan"}], "]"}], "/", "n"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nV3", "=", 
       RowBox[{
        RowBox[{"Part", "[", 
         RowBox[{
          RowBox[{"moment", "[", 
           RowBox[{"\"\<sp\>\"", "<>", 
            RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<nV3\>\""}], 
           "]"}], ",", "tspan", ",", "xspan"}], "]"}], "/", "n"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", 
         RowBox[{"{", 
          RowBox[{"nV1", ",", "nV2", ",", "nV3"}], "}"}], "]"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"nV1", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"nV1", "*", 
           RowBox[{"scale", "/", "max"}]}], "+", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nV2", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"nV2", "*", 
           RowBox[{"scale", "/", "max"}]}], "+", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nV3", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"nV3", "*", 
           RowBox[{"scale", "/", "max"}]}], "+", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{"\"\<x\>\"", ",", "\"\<time\>\""}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"nV1", "//", "Reverse"}], ",", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{"xlim", ",", "tlim"}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotLabel", "\[Rule]", "\"\<nV_x\>\""}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"nV2", "//", "Reverse"}], ",", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{"xlim", ",", "tlim"}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotLabel", "\[Rule]", "\"\<nV_y\>\""}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"nV3", "//", "Reverse"}], ",", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{"xlim", ",", "tlim"}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotLabel", "\[Rule]", "\"\<nV_z\>\""}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Column", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<TemperatureMap\>\"", ",", 
              RowBox[{
               RowBox[{"max", "/", "scale"}], 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Bottom"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "(krnl1) In[44]:=",ExpressionUUID->"08b9de2d-835e-4e84-acf9-936c339443b1"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"field", "=", "moment"}], ",", 
      RowBox[{"sp", "=", "3"}], ",", 
      RowBox[{"kmax", "=", "5"}], ",", 
      RowBox[{"\[Omega]max", "=", "2"}], ",", 
      RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
      RowBox[{"f", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
         RowBox[{"N", "@", 
          RowBox[{"Times", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"$_Integer", "/;", 
                RowBox[{"$", "\[GreaterEqual]", 
                 RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
               RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
            RowBox[{"2", 
             RowBox[{"Pi", "/", 
              RowBox[{"(", 
               RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "kx", ",", "posk", ",", "\[Omega]t", ",", "pos\[Omega]", ",", "w", ",",
         "nV1", ",", "nV2", ",", "nV3", ",", "max", ",", "plots"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"kx", "=", 
        RowBox[{"f", "[", 
         RowBox[{
          RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
          RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"kx", ",", "posk"}], "}"}], "=", 
        RowBox[{"Transpose", "@", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"Sort", "[", 
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"kx", ",", 
               RowBox[{"Range", "[", 
                RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"$_Real", "?", "Positive"}], "/;", 
              RowBox[{
               RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], 
             ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"posk", "=", 
        RowBox[{"Extract", "[", 
         RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"\[Omega]t", "=", 
        RowBox[{"f", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"field", "[", "\"\<time\>\"", "]"}], "//", "Length"}], ",", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"field", "[", 
            RowBox[{"[", 
             RowBox[{"\"\<time\>\"", ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "1"}], "}"}]}], "]"}], "]"}]}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
        RowBox[{"Transpose", "@", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"Sort", "[", 
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"\[Omega]t", ",", 
               RowBox[{"Range", "[", 
                RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
             "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"$_Real", "?", "Positive"}], "/;", 
              RowBox[{
               RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
               "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos\[Omega]", "=", 
        RowBox[{"Extract", "[", 
         RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"w", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"HannWindow", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", "#", "]"}], "]"}], "/", 
             RowBox[{"Length", "[", "#", "]"}]}], "-", ".5"}], "]"}], "&"}], 
         "@", 
         RowBox[{"field", "[", "\"\<time\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nV1", "=", 
        RowBox[{
         RowBox[{"posk", "/@", 
          RowBox[{"pos\[Omega]", "@", 
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Abs", "@", 
              RowBox[{"Fourier", "[", 
               RowBox[{"w", "*", 
                RowBox[{
                 RowBox[{"field", "[", 
                  RowBox[{"\"\<sp\>\"", "<>", 
                   RowBox[{"ToString", "[", "sp", "]"}], "<>", 
                   "\"\<nV1\>\""}], "]"}], "/", 
                 RowBox[{"field", "[", 
                  RowBox[{"\"\<sp\>\"", "<>", 
                   RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<n\>\""}], 
                  "]"}]}]}], "]"}]}], ",", "2"}], "]"}]}]}], "//", 
         "Log10"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nV2", "=", 
        RowBox[{
         RowBox[{"posk", "/@", 
          RowBox[{"pos\[Omega]", "@", 
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Abs", "@", 
              RowBox[{"Fourier", "[", 
               RowBox[{"w", "*", 
                RowBox[{
                 RowBox[{"field", "[", 
                  RowBox[{"\"\<sp\>\"", "<>", 
                   RowBox[{"ToString", "[", "sp", "]"}], "<>", 
                   "\"\<nV2\>\""}], "]"}], "/", 
                 RowBox[{"field", "[", 
                  RowBox[{"\"\<sp\>\"", "<>", 
                   RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<n\>\""}], 
                  "]"}]}]}], "]"}]}], ",", "2"}], "]"}]}]}], "//", 
         "Log10"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nV3", "=", 
        RowBox[{
         RowBox[{"posk", "/@", 
          RowBox[{"pos\[Omega]", "@", 
           RowBox[{"Power", "[", 
            RowBox[{
             RowBox[{"Abs", "@", 
              RowBox[{"Fourier", "[", 
               RowBox[{"w", "*", 
                RowBox[{
                 RowBox[{"field", "[", 
                  RowBox[{"\"\<sp\>\"", "<>", 
                   RowBox[{"ToString", "[", "sp", "]"}], "<>", 
                   "\"\<nV3\>\""}], "]"}], "/", 
                 RowBox[{"field", "[", 
                  RowBox[{"\"\<sp\>\"", "<>", 
                   RowBox[{"ToString", "[", "sp", "]"}], "<>", "\"\<n\>\""}], 
                  "]"}]}]}], "]"}]}], ",", "2"}], "]"}]}]}], "//", 
         "Log10"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"max", "=", 
        RowBox[{"Max", "[", 
         RowBox[{"nV1", ",", "nV2", ",", "nV3"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nV1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"nV1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nV2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"nV2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nV3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"nV3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotRangePadding", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Scaled", "[", 
               RowBox[{".01", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"1", "/", 
                   RowBox[{"(", 
                    RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
               "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "kmax"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ArrayPlot", "[", 
            RowBox[{
             RowBox[{"nV1", "//", "Reverse"}], ",", 
             RowBox[{"DataRange", "->", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"kx", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                RowBox[{"\[Omega]t", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"FrameLabel", "->", 
              RowBox[{"{", 
               RowBox[{
               "\"\<\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(e\)]\)\
\>\"", ",", "None"}], "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"Epilog", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"White", ",", 
                RowBox[{"Text", "[", 
                 RowBox[{
                 "\"\<\[LeftAngleBracket]\!\(\*SubscriptBox[\(v\), \(\
\[DoubleVerticalBar]\)]\)\!\(\*SuperscriptBox[\(\[RightAngleBracket]\), \
\(2\)]\)\>\"", ",", 
                  RowBox[{"Scaled", "[", 
                   RowBox[{"{", 
                    RowBox[{".95", ",", ".95"}], "}"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ArrayPlot", "[", 
            RowBox[{
             RowBox[{"nV2", "//", "Reverse"}], ",", 
             RowBox[{"DataRange", "->", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"kx", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                RowBox[{"\[Omega]t", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"FrameLabel", "->", 
              RowBox[{"{", 
               RowBox[{
               "\"\<\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(e\)]\)\
\>\"", ",", "None"}], "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"Epilog", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"White", ",", 
                RowBox[{"Text", "[", 
                 RowBox[{
                 "\"\<\[LeftAngleBracket]\!\(\*SubscriptBox[\(v\), \(\[UpTee]\
\)]\)\!\(\*SuperscriptBox[\(\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                  RowBox[{"Scaled", "[", 
                   RowBox[{"{", 
                    RowBox[{".95", ",", ".95"}], "}"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ArrayPlot", "[", 
            RowBox[{
             RowBox[{"nV3", "//", "Reverse"}], ",", 
             RowBox[{"DataRange", "->", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"kx", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                RowBox[{"\[Omega]t", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"FrameLabel", "->", 
              RowBox[{"{", 
               RowBox[{
               "\"\<\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(e\)]\)\
\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_e\\)\>\""}], "}"}]}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"Epilog", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"White", ",", 
                RowBox[{"Text", "[", 
                 RowBox[{
                 "\"\<\[LeftAngleBracket]\!\(\*SubscriptBox[\(v\), \(\(\
\[UpTee]\)\(\[UpTee]\)\)]\)\!\(\*SuperscriptBox[\(\[RightAngleBracket]\), \(2\
\)]\)\>\"", ",", 
                  RowBox[{"Scaled", "[", 
                   RowBox[{"{", 
                    RowBox[{".95", ",", ".95"}], "}"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Legended", "[", 
        RowBox[{
         RowBox[{"Column", "[", "plots", "]"}], ",", 
         RowBox[{"Placed", "[", 
          RowBox[{
           RowBox[{"BarLegend", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<Rainbow\>\"", ",", 
               RowBox[{"max", "+", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
             
             RowBox[{"LegendMarkerSize", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"10", ",", "180"}], "}"}]}], ",", 
             RowBox[{"LegendMargins", "\[Rule]", "0"}]}], "]"}], ",", 
           "Right"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "(krnl1) In[46]:=",ExpressionUUID->"784037ef-ad62-4978-9610-28ae6f4df14a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsection",ExpressionUUID->"6e553140-7a66-4632-b48b-e250a4b9679b"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"wd", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"demo", "=", "\"\<figure_1a-AhHe_1.5/PC_full_f_2\>\""}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<.\>\"", ",", "demo"}], "}"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], "*)"}]], "Input",ExpressionUUID->\
"543d8f28-effe-4d70-b264-f2b4783bac9d"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "loadMeta", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"loadMeta", "[", 
   RowBox[{"spid_Integer", "?", "Positive"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{"spid", "=", "1"}], "*)"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "paths", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"paths", "=", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"FileNames", "[", 
           RowBox[{
            RowBox[{"\"\<particle-sp_\>\"", "<>", 
             RowBox[{"ToString", "[", "spid", "]"}], "<>", "\"\<-*\>\""}], 
            ",", "wd"}], "]"}], ",", 
          RowBox[{"Function", "[", 
           RowBox[{"path", ",", "\[IndentingNewLine]", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"s", "=", 
                RowBox[{"FileNameTake", "[", "path", "]"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"StringCases", "[", 
               RowBox[{"s", ",", 
                RowBox[{
                 RowBox[{"\"\<-\>\"", "~~", 
                  RowBox[{"i", ":", "NumberString"}], "~~", "\"\<.\>\""}], 
                 "\[RuleDelayed]", 
                 RowBox[{"ToExpression", "[", "i", "]"}]}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[LeftAssociation]", 
        RowBox[{
         RowBox[{"\"\<sp\>\"", "\[Rule]", "spid"}], ",", 
         RowBox[{"\"\<files\>\"", "\[Rule]", "paths"}]}], 
        "\[RightAssociation]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellLabel->
  "In[1498]:=",ExpressionUUID->"62c172ad-23b6-4f60-9b94-12c95f2a21b5"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "calHist", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"calHist", "[", 
   RowBox[{"ptl_Association", ",", "vlim_Interval", ",", 
    RowBox[{"dv_", "?", "Positive"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"ptl", "=", "ptl"}], ","}], "*)"}], 
     RowBox[{
      RowBox[{"v1spec", "=", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"MinMax", "[", "vlim", "]"}], ",", "dv"}], "]"}]}], ",", 
      RowBox[{"v2spec", "=", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"Max", "[", "vlim", "]"}], ",", "dv"}], "}"}]}]}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "w", ",", "v1", ",", "v2", ",", "binning", ",", "bins", ",", "f", ",", 
        "df", ",", "f1", ",", "df1", ",", "f2", ",", "df2"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"w", "=", 
        RowBox[{"ptl", "[", "\"\<w\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"v1", "=", 
        RowBox[{"ptl", "[", "\"\<v1\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v2", "=", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ptl", "[", "\"\<v2\>\"", "]"}], "^", "2"}], "+", 
          RowBox[{
           RowBox[{"ptl", "[", "\"\<v3\>\"", "]"}], "^", "2"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"binning", "=", 
        RowBox[{"Compile", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"v1", ",", "_Real"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"v2", ",", "_Real"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"w", ",", "_Real"}], "}"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"i1", "=", "0"}], ",", 
              RowBox[{"i2", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"i1", "=", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"v1", "-", 
                   RowBox[{"v1spec", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", 
                 RowBox[{"Last", "[", "v1spec", "]"}]}], "]"}], "+", "1"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"i2", "=", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"v2", "-", 
                   RowBox[{"v2spec", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", 
                 RowBox[{"Last", "[", "v2spec", "]"}]}], "]"}], "+", "1"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i1", ",", "w", ",", "i2"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"RuntimeAttributes", "\[Rule]", 
           RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"bins", "=", 
        RowBox[{"binning", "[", 
         RowBox[{"v1", ",", "v2", ",", "w"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"v2", "=", 
        RowBox[{"N", "@", 
         RowBox[{"MovingAverage", "[", 
          RowBox[{
           RowBox[{"Range", "@@", "v2spec"}], ",", "2"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{"N", "@", 
         RowBox[{"MovingAverage", "[", 
          RowBox[{
           RowBox[{"Range", "@@", "v1spec"}], ",", "2"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f", "=", 
        RowBox[{"Cases", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"Round", "[", 
               RowBox[{"Most", "@", 
                RowBox[{"Part", "[", 
                 RowBox[{"#", ",", "1"}], "]"}]}], "]"}], ",", 
              RowBox[{"Through", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Length", ",", "Total"}], "}"}], "[", 
                RowBox[{"Last", "/@", "#"}], "]"}], "]"}]}], "]"}], "&"}], "/@", 
           RowBox[{"SplitBy", "[", 
            RowBox[{
             RowBox[{"SortBy", "[", 
              RowBox[{"(*", 
               RowBox[{"{", 
                RowBox[{"i2", ",", "i1", ",", "w"}], "}"}], "*)"}], 
              RowBox[{
               RowBox[{"RotateRight", "/@", "bins"}], ",", "Most"}], "]"}], 
             ",", "Most"}], "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"HoldPattern", "[", 
           RowBox[{"Rule", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"$2_Integer", "?", "Positive"}], "/;", 
                RowBox[{"$2", "\[LessEqual]", 
                 RowBox[{"Length", "[", "v2", "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"$1_Integer", "?", "Positive"}], "/;", 
                RowBox[{"$1", "\[LessEqual]", 
                 RowBox[{"Length", "[", "v1", "]"}]}]}]}], "}"}], ",", 
             "_List"}], "]"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f", "=", 
        RowBox[{"ReplacePart", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}], ",", 
            RowBox[{"{", "v2", "}"}], ",", 
            RowBox[{"{", "v1", "}"}]}], "]"}], ",", "f"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"f1", ",", "df1"}], "}"}], "=", 
        RowBox[{
         RowBox[{"Total", "[", "f", "]"}], "\[Transpose]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"f2", ",", "df2"}], "}"}], "=", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{"Total", ",", "f"}], "]"}], "\[Transpose]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"f", ",", "df"}], "}"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"f", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "3", "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", 
            RowBox[{"{", "2", "}"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f1", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v1spec", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"df1", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v1spec", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"f2", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v2spec", "]"}], 
         RowBox[{"(", 
          RowBox[{"2", "Pi", " ", "v2"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"df2", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v2spec", "]"}], 
         RowBox[{"(", 
          RowBox[{"2", "Pi", " ", "v2"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v1spec", "]"}], 
         RowBox[{"Last", "[", "v2spec", "]"}], 
         RowBox[{"(", 
          RowBox[{"2", "Pi", " ", "v2"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"df", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v1spec", "]"}], 
         RowBox[{"Last", "[", "v2spec", "]"}], 
         RowBox[{"(", 
          RowBox[{"2", "Pi", " ", "v2"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", "return", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Association", "[", 
        RowBox[{
         RowBox[{"\"\<v1\>\"", "\[Rule]", "v1"}], ",", 
         RowBox[{"\"\<v2\>\"", "\[Rule]", "v2"}], ",", 
         RowBox[{"\"\<f\>\"", "\[Rule]", "f"}], ",", 
         RowBox[{"\"\<df\>\"", "\[Rule]", "df"}], ",", 
         RowBox[{"\"\<f1\>\"", "\[Rule]", "f1"}], ",", 
         RowBox[{"\"\<df1\>\"", "\[Rule]", "df1"}], ",", 
         RowBox[{"\"\<f2\>\"", "\[Rule]", "f2"}], ",", 
         RowBox[{"\"\<df2\>\"", "\[Rule]", "df2"}], ",", 
         RowBox[{"\"\<time\>\"", "\[Rule]", 
          RowBox[{"ptl", "[", "\"\<time\>\"", "]"}]}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"calHist", "[", 
   RowBox[{
    RowBox[{"file_String", "?", "FileExistsQ"}], ",", "vlim_Interval", ",", 
    RowBox[{"dv_", "?", "Positive"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"calHist", "[", 
    RowBox[{"file", ",", "vlim", ",", "dv"}], "]"}], "=", 
   RowBox[{"calHist", "[", 
    RowBox[{
     RowBox[{"importParticles", "[", "file", "]"}], ",", "vlim", ",", "dv"}], 
    "]"}]}]}]}], "Input",
 CellLabel->
  "In[1500]:=",ExpressionUUID->"ae70b0b0-e5e2-48f5-a8db-d4a0b7d9da8f"],

Cell[CellGroupData[{

Cell["hot p", "Subsubsection",ExpressionUUID->"3938827d-1b1e-459f-9f11-0b3212fdd467"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"metaM", "=", 
   RowBox[{"loadMeta", "[", "1", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "metaM"}]}], "Input",ExpressionUUID->"8286369a-\
e077-4ac5-84fc-320b7d8469c0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"metaLC", "=", 
   RowBox[{"loadMeta", "[", "2", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "metaLC"}]}], "Input",
 CellLabel->
  "In[295]:=",ExpressionUUID->"fa0c2c9b-76a8-4deb-940e-7f551a1f1454"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"idx", "=", 
      RowBox[{"-", "1"}]}], ",", 
     RowBox[{"metaM", "=", "metaM"}], ",", 
     RowBox[{"metaLC", "=", "metaLC"}], ",", 
     RowBox[{"nv", "=", "95"}], ",", 
     RowBox[{"\[Theta]1", "=", 
      SqrtBox["0.9783942329567167"]}], ",", 
     RowBox[{"\[Alpha]", "=", "2.5"}], ",", 
     RowBox[{"\[CapitalDelta]", "=", "0"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"histM", ",", "histLC", ",", 
       RowBox[{"\[Beta]", "=", 
        RowBox[{"1", "/", "\[Alpha]"}]}], ",", 
       RowBox[{"\[Xi]", "=", "\[Alpha]"}], ",", 
       RowBox[{"c", "=", 
        RowBox[{"1", "-", 
         RowBox[{"1", "/", "\[Alpha]"}]}]}], ",", "vlim"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vlim", "=", 
       RowBox[{"4", "\[Theta]1", " ", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histM", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaM", "[", "\"\<files\>\"", "]"}], ",", "idx"}], "]"}], 
         ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histLC", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaLC", "[", "\"\<files\>\"", "]"}], ",", "idx"}], "]"}],
          ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"##", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], ",", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Plot", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], "]"}], "/", 
                 RowBox[{"(", 
                  RowBox[{
                   SqrtBox["\[Pi]"], "\[Alpha]", " ", "\[Theta]1"}], ")"}]}], 
                ",", 
                RowBox[{"c", " ", 
                 RowBox[{
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                    RowBox[{"\[Theta]1", "^", "2"}]}], "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{
                    SqrtBox["\[Pi]"], "\[Theta]1"}], ")"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], "]"}], "/", 
                 RowBox[{"(", 
                  RowBox[{
                   SqrtBox["\[Pi]"], "\[Theta]1"}], ")"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"Min", "[", "vlim", "]"}], ",", 
                RowBox[{"Max", "[", "vlim", "]"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotStyle", "\[Rule]", 
               RowBox[{"Directive", "[", 
                RowBox[{"Thickness", "[", "Medium", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Plot", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], "]"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"\[Pi]", " ", "\[Alpha]", " ", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], ")"}]}], ",", 
                RowBox[{"c", " ", 
                 RowBox[{
                  RowBox[{"Subtract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"\[CapitalDelta]", " ", "\[Beta]"}]}], ")"}], 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                    RowBox[{"\[Theta]1", "^", "2"}]}], "/", "\[Xi]"}], 
                    "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", "\[CapitalDelta]"}], ")"}], 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                    RowBox[{"\[Theta]1", "^", "2"}]}], "/", "\[Xi]"}], "/", 
                    "\[Beta]"}], "]"}]}]}], "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Pi]", " ", "\[Xi]", " ", 
                    RowBox[{"\[Theta]1", "^", "2"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "-", "\[Beta]"}], ")"}]}], ")"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                    RowBox[{"\[Theta]1", "^", "2"}]}], "/", "\[Alpha]"}], 
                  "]"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"\[Pi]", " ", "\[Alpha]", " ", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], ")"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "0", ",", 
                RowBox[{"Max", "[", "vlim", "]"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotStyle", "\[Rule]", 
               RowBox[{"Directive", "[", 
                RowBox[{"Thickness", "[", "Medium", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
             "\[IndentingNewLine]", "]"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histM", "[", "\"\<v1\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{"histM", "[", "\"\<f1\>\"", "]"}], "/", 
                    "\[Alpha]"}]}], "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histLC", "[", "\"\<v1\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{"histLC", "[", "\"\<f1\>\"", "]"}], "c"}]}], 
                  "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histM", "[", "\"\<v1\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"histM", "[", "\"\<f1\>\"", "]"}], "/", 
                    "\[Alpha]"}], "+", 
                    RowBox[{
                    RowBox[{"histLC", "[", "\"\<f1\>\"", "]"}], "c"}]}]}], 
                  "}"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
              "PlotMarkers", "\[Rule]", "\"\<\[EmptySmallCircle]\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histM", "[", "\"\<v2\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{"histM", "[", "\"\<f2\>\"", "]"}], "/", 
                    "\[Alpha]"}]}], "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histLC", "[", "\"\<v2\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{"histLC", "[", "\"\<f2\>\"", "]"}], "c"}]}], 
                  "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histM", "[", "\"\<v2\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"histM", "[", "\"\<f2\>\"", "]"}], "/", 
                    "\[Alpha]"}], "+", 
                    RowBox[{
                    RowBox[{"histLC", "[", "\"\<f2\>\"", "]"}], "c"}]}]}], 
                  "}"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
              "PlotMarkers", "\[Rule]", "\"\<\[EmptySmallCircle]\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
             "\[IndentingNewLine]", "]"}]}], "}"}]}], "\[IndentingNewLine]", 
         "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[297]:=",ExpressionUUID->"9c568c53-9ef9-4225-b027-4e8c5464ddbf"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"idx", "=", 
      RowBox[{"-", "1"}]}], ",", 
     RowBox[{"metaM", "=", "metaM"}], ",", 
     RowBox[{"metaLC", "=", "metaLC"}], ",", 
     RowBox[{"nv", "=", "95"}], ",", 
     RowBox[{"\[Theta]1", "=", 
      SqrtBox["0.9783942329567167"]}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "histM", ",", "histLC", ",", "histM0", ",", "histLC0", ",", "vlim", ",",
        "v1", ",", "v2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vlim", "=", 
       RowBox[{"4", "\[Theta]1", " ", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histM0", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaM", "[", "\"\<files\>\"", "]"}], ",", "1"}], "]"}], 
         ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histLC0", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaLC", "[", "\"\<files\>\"", "]"}], ",", "1"}], "]"}], 
         ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"v1", "=", 
       RowBox[{"histM0", "[", "\"\<v1\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"v2", "=", 
       RowBox[{"histM0", "[", "\"\<v2\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histM", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaM", "[", "\"\<files\>\"", "]"}], ",", "idx"}], "]"}], 
         ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histLC", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaLC", "[", "\"\<files\>\"", "]"}], ",", "idx"}], "]"}],
          ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Show", "[", 
         RowBox[{"#", ",", "\[IndentingNewLine]", 
          RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "\[IndentingNewLine]",
          "]"}], "&"}], "/@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"histM", "[", "\"\<f\>\"", "]"}], "//", "Reverse"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"histLC", "[", "\"\<f\>\"", "]"}], "//", "Reverse"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"histLC", "[", "\"\<df\>\"", "]"}], "//", "Reverse"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"v1", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                RowBox[{"v2", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}]}],
             "\[IndentingNewLine]", "]"}], ","}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"histM", "[", "\"\<f\>\"", "]"}], "-", 
             RowBox[{"histM0", "[", "\"\<f\>\"", "]"}]}], "//", "Reverse"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"histLC", "[", "\"\<f\>\"", "]"}], "-", 
             RowBox[{"histLC0", "[", "\"\<f\>\"", "]"}]}], "//", "Reverse"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[298]:=",ExpressionUUID->"8c70e40b-4d95-4331-b84e-6a3f70f2f64a"]
}, Closed]],

Cell[CellGroupData[{

Cell["hot He", "Subsubsection",ExpressionUUID->"8d119985-d768-4a0e-aec4-49a91cb85b3e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"metaM", "=", 
   RowBox[{"loadMeta", "[", "3", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "metaM"}]}], "Input",
 CellLabel->
  "In[299]:=",ExpressionUUID->"343305eb-5e63-4f00-8bc7-e811b13f9b38"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"metaLC", "=", 
   RowBox[{"loadMeta", "[", "4", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "metaLC"}]}], "Input",
 CellLabel->
  "In[301]:=",ExpressionUUID->"688e2f3b-8c54-4f0c-920a-faa471f5cd5c"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"idx", "=", 
      RowBox[{"-", "1"}]}], ",", 
     RowBox[{"metaM", "=", "metaM"}], ",", 
     RowBox[{"metaLC", "=", "metaLC"}], ",", 
     RowBox[{"nv", "=", "95"}], ",", 
     RowBox[{"\[Theta]1", "=", 
      RowBox[{
       SqrtBox["0.9783942329567167"], "/", "2"}]}], ",", 
     RowBox[{"\[Alpha]", "=", 
      RowBox[{"2.5", "+", "1*^-5"}]}], ",", 
     RowBox[{"\[CapitalDelta]", "=", "0"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"histM", ",", "histLC", ",", 
       RowBox[{"\[Beta]", "=", 
        RowBox[{"1", "/", "\[Alpha]"}]}], ",", 
       RowBox[{"\[Xi]", "=", "\[Alpha]"}], ",", 
       RowBox[{"c", "=", 
        RowBox[{"1", "-", 
         RowBox[{"1", "/", "\[Alpha]"}]}]}], ",", "vlim"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vlim", "=", 
       RowBox[{"4", "\[Theta]1", " ", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histM", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaM", "[", "\"\<files\>\"", "]"}], ",", "idx"}], "]"}], 
         ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histLC", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaLC", "[", "\"\<files\>\"", "]"}], ",", "idx"}], "]"}],
          ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"##", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], ",", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Plot", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], "]"}], "/", 
                 RowBox[{"(", 
                  RowBox[{
                   SqrtBox["\[Pi]"], "\[Alpha]", " ", "\[Theta]1"}], ")"}]}], 
                ",", 
                RowBox[{"c", " ", 
                 RowBox[{
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                    RowBox[{"\[Theta]1", "^", "2"}]}], "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{
                    SqrtBox["\[Pi]"], "\[Theta]1"}], ")"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], "]"}], "/", 
                 RowBox[{"(", 
                  RowBox[{
                   SqrtBox["\[Pi]"], "\[Theta]1"}], ")"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"Min", "[", "vlim", "]"}], ",", 
                RowBox[{"Max", "[", "vlim", "]"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotStyle", "\[Rule]", 
               RowBox[{"Directive", "[", 
                RowBox[{"Thickness", "[", "Medium", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Plot", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], "]"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"\[Pi]", " ", "\[Alpha]", " ", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], ")"}]}], ",", 
                RowBox[{"c", " ", 
                 RowBox[{
                  RowBox[{"Subtract", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"\[CapitalDelta]", " ", "\[Beta]"}]}], ")"}], 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                    RowBox[{"\[Theta]1", "^", "2"}]}], "/", "\[Xi]"}], 
                    "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", "\[CapitalDelta]"}], ")"}], 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                    RowBox[{"\[Theta]1", "^", "2"}]}], "/", "\[Xi]"}], "/", 
                    "\[Beta]"}], "]"}]}]}], "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Pi]", " ", "\[Xi]", " ", 
                    RowBox[{"\[Theta]1", "^", "2"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "-", "\[Beta]"}], ")"}]}], ")"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"x", "^", "2"}]}], "/", 
                    RowBox[{"\[Theta]1", "^", "2"}]}], "/", "\[Alpha]"}], 
                  "]"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"\[Pi]", " ", "\[Alpha]", " ", 
                   RowBox[{"\[Theta]1", "^", "2"}]}], ")"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "0", ",", 
                RowBox[{"Max", "[", "vlim", "]"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotStyle", "\[Rule]", 
               RowBox[{"Directive", "[", 
                RowBox[{"Thickness", "[", "Medium", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
             "\[IndentingNewLine]", "]"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histM", "[", "\"\<v1\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{"histM", "[", "\"\<f1\>\"", "]"}], "/", 
                    "\[Alpha]"}]}], "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histLC", "[", "\"\<v1\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{"histLC", "[", "\"\<f1\>\"", "]"}], "c"}]}], 
                  "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histM", "[", "\"\<v1\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"histM", "[", "\"\<f1\>\"", "]"}], "/", 
                    "\[Alpha]"}], "+", 
                    RowBox[{
                    RowBox[{"histLC", "[", "\"\<f1\>\"", "]"}], "c"}]}]}], 
                  "}"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
              "PlotMarkers", "\[Rule]", "\"\<\[EmptySmallCircle]\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histM", "[", "\"\<v2\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{"histM", "[", "\"\<f2\>\"", "]"}], "/", 
                    "\[Alpha]"}]}], "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histLC", "[", "\"\<v2\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{"histLC", "[", "\"\<f2\>\"", "]"}], "c"}]}], 
                  "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"histM", "[", "\"\<v2\>\"", "]"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"histM", "[", "\"\<f2\>\"", "]"}], "/", 
                    "\[Alpha]"}], "+", 
                    RowBox[{
                    RowBox[{"histLC", "[", "\"\<f2\>\"", "]"}], "c"}]}]}], 
                  "}"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
              "PlotMarkers", "\[Rule]", "\"\<\[EmptySmallCircle]\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"PlotRange", "\[Rule]", "All"}]}], 
             "\[IndentingNewLine]", "]"}]}], "}"}]}], "\[IndentingNewLine]", 
         "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[303]:=",ExpressionUUID->"6fc9d06d-183f-4665-b911-2e73c82ad8ae"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"idx", "=", 
      RowBox[{"-", "1"}]}], ",", 
     RowBox[{"metaM", "=", "metaM"}], ",", 
     RowBox[{"metaLC", "=", "metaLC"}], ",", 
     RowBox[{"nv", "=", "95"}], ",", 
     RowBox[{"\[Theta]1", "=", 
      RowBox[{
       SqrtBox["0.9783942329567167"], "/", "2"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "histM", ",", "histLC", ",", "histM0", ",", "histLC0", ",", "vlim", ",",
        "v1", ",", "v2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vlim", "=", 
       RowBox[{"4", "\[Theta]1", " ", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histM0", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaM", "[", "\"\<files\>\"", "]"}], ",", "1"}], "]"}], 
         ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histLC0", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaLC", "[", "\"\<files\>\"", "]"}], ",", "1"}], "]"}], 
         ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"v1", "=", 
       RowBox[{"histM0", "[", "\"\<v1\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"v2", "=", 
       RowBox[{"histM0", "[", "\"\<v2\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histM", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaM", "[", "\"\<files\>\"", "]"}], ",", "idx"}], "]"}], 
         ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"histLC", "=", 
       RowBox[{"calHist", "[", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"metaLC", "[", "\"\<files\>\"", "]"}], ",", "idx"}], "]"}],
          ",", "vlim", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", "nv"}], " ", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"MinMax", "[", "vlim", "]"}]}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Show", "[", 
         RowBox[{"#", ",", "\[IndentingNewLine]", 
          RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "\[IndentingNewLine]",
          "]"}], "&"}], "/@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"histM", "[", "\"\<f\>\"", "]"}], "//", "Reverse"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"histLC", "[", "\"\<f\>\"", "]"}], "//", "Reverse"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"histLC", "[", "\"\<df\>\"", "]"}], "//", "Reverse"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"v1", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                RowBox[{"v2", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}]}],
             "\[IndentingNewLine]", "]"}], ","}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"histM", "[", "\"\<f\>\"", "]"}], "-", 
             RowBox[{"histM0", "[", "\"\<f\>\"", "]"}]}], "//", "Reverse"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"histLC", "[", "\"\<f\>\"", "]"}], "-", 
             RowBox[{"histLC0", "[", "\"\<f\>\"", "]"}]}], "//", "Reverse"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[304]:=",ExpressionUUID->"966d3d3c-19a1-4854-9f84-68e50feaa800"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["VHist", "Subsection",ExpressionUUID->"0d6aa187-8bc5-4171-a8d8-717cf13ac904"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"wd", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"demo", "=", "\"\<0_control/data\>\""}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<.\>\"", ",", "demo"}], "}"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], "*)"}]], "Input",ExpressionUUID->\
"2ac064a6-91b5-4ab6-9568-16b843d6ebc5"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importPSD2d", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importPSD2d", "[", 
   RowBox[{"spid_Integer", "?", "Positive"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"spid", "=", "2"}], ","}], "*)"}], 
     RowBox[{"root", "=", "wd"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"files", ",", "vhists"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{
          RowBox[{"\"\<vhist2d-sp_\>\"", "<>", 
           RowBox[{"ToString", "[", "spid", "]"}], "<>", "\"\<-*\>\""}], ",", 
          "root"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vhists", "=", 
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{"file", ",", 
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"assoc", ",", "idxs", ",", "dV"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"assoc", "=", 
               RowBox[{"importVHist2d", "[", "file", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"idxs", "=", 
               RowBox[{"assoc", "[", "\"\<idxs\>\"", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"dV", "=", 
               RowBox[{"2", "Pi", " ", 
                RowBox[{"assoc", "[", "\"\<v2\>\"", "]"}], 
                RowBox[{"(", 
                 RowBox[{"Subtract", "@@", 
                  RowBox[{"assoc", "[", 
                   RowBox[{"[", 
                    RowBox[{"\"\<v1\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "1"}], "}"}]}], "]"}], "]"}]}], ")"}], 
                RowBox[{"(", 
                 RowBox[{"Subtract", "@@", 
                  RowBox[{"assoc", "[", 
                   RowBox[{"[", 
                    RowBox[{"\"\<v2\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "1"}], "}"}]}], "]"}], "]"}]}], 
                 ")"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"assoc", "[", "\"\<vhist\>\"", "]"}], "=", 
               RowBox[{"Normal", "@", 
                RowBox[{"SparseArray", "[", 
                 RowBox[{
                  RowBox[{"idxs", "\[Rule]", 
                   RowBox[{"assoc", "[", "\"\<vhist\>\"", "]"}]}], ",", 
                  RowBox[{"assoc", "[", "\"\<vdims\>\"", "]"}]}], "]"}]}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"assoc", "[", "\"\<whist\>\"", "]"}], "=", 
               RowBox[{"Normal", "@", 
                RowBox[{"SparseArray", "[", 
                 RowBox[{
                  RowBox[{"idxs", "\[Rule]", 
                   RowBox[{"assoc", "[", "\"\<whist\>\"", "]"}]}], ",", 
                  RowBox[{"assoc", "[", "\"\<vdims\>\"", "]"}]}], "]"}]}]}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"assoc", "[", "\"\<vpsd\>\"", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Divide", "[", 
                  RowBox[{"#", ",", "dV"}], "]"}], "&"}], "/@", 
                RowBox[{"assoc", "[", "\"\<vhist\>\"", "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"assoc", "[", "\"\<wpsd\>\"", "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Divide", "[", 
                  RowBox[{"#", ",", "dV"}], "]"}], "&"}], "/@", 
                RowBox[{"assoc", "[", "\"\<whist\>\"", "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"KeyDrop", "[", 
               RowBox[{"assoc", ",", "\"\<idxs\>\""}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], "]"}], "/@", "files"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vhists", "=", 
        RowBox[{"SortBy", "[", 
         RowBox[{"vhists", ",", 
          RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "vhists"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellLabel->
  "In[1803]:=",ExpressionUUID->"d736b68d-c847-470a-902c-18f0c5be7f3a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"importPSD2d", "[", "3", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1812]:=",ExpressionUUID->"eb515612-0f02-4381-a0ab-55b2918aef12"],

Cell[BoxData[
 RowBox[{"vhist", "//", "Dimensions"}]], "Input",
 CellLabel->
  "In[1813]:=",ExpressionUUID->"72596cd4-4181-46c0-ab2a-433a66160832"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"vhist", "=", 
       RowBox[{"vhist", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", 
      RowBox[{"\[Beta]1", "=", 
       RowBox[{"0.978394", "/", "1"}]}], ",", 
      RowBox[{"T2OT1", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "f1", ",", "f2"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"v1", "=", 
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f1", "=", 
        RowBox[{
         RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"v2", "=", 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f2", "=", 
        RowBox[{
         RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "[", 
         RowBox[{"[", "100", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", 
            RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}], "&"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"Chop", "@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{"v1", ",", "f1"}], "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{"v1", ",", 
                   RowBox[{
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"v1", "^", "2"}]}], "/", "\[Beta]1"}], "]"}], "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sqrt", "[", 
                    RowBox[{"Pi", " ", "\[Beta]1"}], "]"}], "Pi"}], ")"}]}]}],
                   "}"}], "]"}]}], "}"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"False", ",", "True"}], "}"}]}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"Chop", "@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{"v2", ",", "f2"}], "}"}], "]"}], ",", 
                RowBox[{"Thread", "[", 
                 RowBox[{"{", 
                  RowBox[{"v2", ",", 
                   RowBox[{
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"v2", "^", "2"}]}], "/", "\[Beta]1"}], "/", 
                    "T2OT1"}], "]"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", "T2OT1", " ", "Pi", 
                    SqrtBox["Pi"]}], ")"}]}]}], "}"}], "]"}]}], "}"}]}], ",", 
             
             RowBox[{"Joined", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"False", ",", "True"}], "}"}]}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}], "*)"}]], "Input",
 CellLabel->
  "In[1580]:=",ExpressionUUID->"3e45f4ca-d836-4c9b-9a61-08705c3e101a"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", 
      RowBox[{"vhist", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ",", 
     RowBox[{"\[Beta]1", "=", 
      RowBox[{"0.978394", "/", "1"}]}], ",", 
     RowBox[{"T2OT1", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v1", ",", "v2", ",", "f1", ",", "f2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"v1", "=", 
       RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"f1", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{
         RowBox[{"Total", "/@", 
          RowBox[{"vhist", "[", "\"\<vhist\>\"", "]"}]}], ",", 
         RowBox[{
          RowBox[{"v1", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "-", 
          RowBox[{"v1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"v2", "=", 
       RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"f2", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{
         RowBox[{"Total", "@", 
          RowBox[{"vhist", "[", "\"\<vhist\>\"", "]"}]}], ",", 
         RowBox[{
          RowBox[{"v2", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "-", 
          RowBox[{"v2", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}], "&"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Chop", "@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"v1", ",", "f1"}], "}"}], "]"}], ",", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"v1", ",", 
                  RowBox[{
                   RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"v1", "^", "2"}]}], "/", "\[Beta]1"}], "]"}], "/", 
                   RowBox[{"Sqrt", "[", 
                    RowBox[{"Pi", " ", "\[Beta]1"}], "]"}]}]}], "}"}], 
                "]"}]}], "}"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"False", ",", "True"}], "}"}]}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Chop", "@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"v2", ",", "f2"}], "}"}], "]"}], ",", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"v2", ",", 
                  RowBox[{"2", "v2", " ", 
                   RowBox[{
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"v2", "^", "2"}]}], "/", "\[Beta]1"}], "/", 
                    "T2OT1"}], "]"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", "T2OT1"}], ")"}]}]}]}], "}"}], 
                "]"}]}], "}"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"False", ",", "True"}], "}"}]}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1581]:=",ExpressionUUID->"e1844ae8-c134-4b82-b152-6200fd7faa72"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"vhist", "=", 
     RowBox[{"vhist", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v1", ",", "v2", ",", "f", ",", "d"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"v1", "=", 
       RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"v2", "=", 
       RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"f", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<vhist\>\"", "]"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"d", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<whist\>\"", "]"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Show", "[", 
         RowBox[{"#", ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"FrameTicks", "\[Rule]", "Automatic"}]}], 
         "\[IndentingNewLine]", "]"}], "&"}], "/@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"f", "\[Transpose]"}], "//", "Reverse"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], "]"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"d", "\[Transpose]"}], "//", "Reverse"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"v1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"v2", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}]}], 
          "]"}]}], "\[IndentingNewLine]", "}"}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1816]:=",ExpressionUUID->"2c4e7230-b6f8-4d4e-9bff-d1ca239d3243"],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{"\"\<~/Downloads/vhist3.gif\>\"", ",", 
   RowBox[{
    RowBox[{"Function", "[", 
     RowBox[{
      RowBox[{"{", "vhist", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"v1", ",", "v2", ",", "f", ",", "d"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"v1", "=", 
          RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"v2", "=", 
          RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"f", "=", 
          RowBox[{
           RowBox[{"vhist", "[", "\"\<vhist\>\"", "]"}], "//", "Chop"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"d", "=", 
          RowBox[{
           RowBox[{"vhist", "[", "\"\<whist\>\"", "]"}], "//", "Chop"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"FrameTicks", "\[Rule]", "Automatic"}]}], 
            "\[IndentingNewLine]", "]"}], "&"}], "/@", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ArrayPlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"f", "\[Transpose]"}], "//", "Reverse"}], ",", 
              RowBox[{"DataRange", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"v1", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                 RowBox[{"v2", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
              RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], 
             "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"ArrayPlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"d", "\[Transpose]"}], "//", "Reverse"}], ",", 
              RowBox[{"DataRange", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"v1", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                 RowBox[{"v2", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
              RowBox[{
              "ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}]}], 
             "]"}]}], "\[IndentingNewLine]", "}"}]}]}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], "/@", 
    "vhist"}]}], "]"}]], "Input",
 CellLabel->
  "In[1815]:=",ExpressionUUID->"86920e85-a2e2-4848-90aa-5a797c879cf2"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1329, 1072},
WindowMargins->{{58, Automatic}, {Automatic, 77}},
FrontEndVersion->"12.1 for Mac OS X x86 (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"13c7468d-72b3-4754-a7ae-58931f6d390a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 87, 0, 67, "Section",ExpressionUUID->"f035238d-a3d4-4d2c-96d0-0fa572842c23"],
Cell[CellGroupData[{
Cell[692, 26, 83, 0, 54, "Subsection",ExpressionUUID->"e128867d-f81c-4723-a5f3-00f9a32a5b13"],
Cell[778, 28, 2270, 58, 241, "Input",ExpressionUUID->"d78cce98-3a82-4785-85db-8be2519bd616"],
Cell[3051, 88, 4458, 119, 472, "Input",ExpressionUUID->"832b9a46-ac29-42bb-9d5f-ba56a5964cbf"],
Cell[7512, 209, 7386, 191, 661, "Input",ExpressionUUID->"984258eb-365b-4048-ab10-6220b1896c2a"],
Cell[14901, 402, 7227, 198, 682, "Input",ExpressionUUID->"9ed86c53-5481-4662-b095-0d009e616ab7"],
Cell[22131, 602, 6783, 171, 766, "Input",ExpressionUUID->"f67f68d7-f19f-4adc-856d-65cc92e39e1f"]
}, Closed]],
Cell[CellGroupData[{
Cell[28951, 778, 83, 0, 38, "Subsection",ExpressionUUID->"8ea02f9c-9d0e-41fa-8e9e-85bc94c2bc74"],
Cell[29037, 780, 11405, 290, 1123, "Input",ExpressionUUID->"6c2a0e21-e5ea-4d3b-9332-3fc1d7a2734a"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[40491, 1076, 82, 0, 67, "Section",ExpressionUUID->"a49cfbcd-1345-45bc-a353-15faed1a68e3"],
Cell[40576, 1078, 351, 9, 73, "Input",ExpressionUUID->"4a819e33-64b4-484a-bf21-d831b367a6e4"],
Cell[CellGroupData[{
Cell[40952, 1091, 83, 0, 54, "Subsection",ExpressionUUID->"83125ca6-ce33-438f-8af7-0792b1533a0a"],
Cell[41038, 1093, 464, 13, 73, "Input",ExpressionUUID->"608f2eae-8bf8-46fb-8f5e-f9604c81d58a"],
Cell[41505, 1108, 3618, 89, 325, "Input",ExpressionUUID->"0a3b8942-02d9-4e97-b7a4-fde7759b5922"],
Cell[45126, 1199, 154, 3, 30, "Input",ExpressionUUID->"7cb0b11d-5057-4184-96b5-71e03da3d996"],
Cell[45283, 1204, 5545, 134, 472, "Input",ExpressionUUID->"b09a43c0-ee69-41ea-9af1-337d08b98870"],
Cell[50831, 1340, 4959, 122, 493, "Input",ExpressionUUID->"d91caf77-0cde-4350-bdc1-36afcbcbc488"],
Cell[55793, 1464, 5422, 138, 493, "Input",ExpressionUUID->"61d0a445-f7fd-40bd-a08d-4749f3a3b19a"],
Cell[61218, 1604, 4926, 127, 409, "Input",ExpressionUUID->"55deacc0-898f-4621-8934-8d58830930c0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[66181, 1736, 82, 0, 54, "Subsection",ExpressionUUID->"4ef98a16-4706-471c-ab3d-9c94ac395b4b"],
Cell[66266, 1738, 458, 13, 73, "Input",ExpressionUUID->"6eb39148-092a-4364-9cb4-6de587274b53"],
Cell[66727, 1753, 2317, 57, 283, "Input",ExpressionUUID->"50a9efda-d764-4a41-82a5-3c129608138d"],
Cell[69047, 1812, 153, 3, 30, "Input",ExpressionUUID->"eebd8508-0302-44e4-af48-83820ff9683f"],
Cell[69203, 1817, 6331, 164, 682, "Input",ExpressionUUID->"bd63cbba-380a-4865-a0ec-2d81e9ecb862"],
Cell[75537, 1983, 7664, 195, 829, "Input",ExpressionUUID->"332560ff-2177-4a1b-9c52-0e47523d1abf"],
Cell[83204, 2180, 11813, 300, 1002, "Input",ExpressionUUID->"59e6d83f-a7fd-4e5a-a6ee-75425b33a3af"],
Cell[95020, 2482, 12973, 329, 1004, "Input",ExpressionUUID->"d92d7554-db5f-46aa-852f-7cf228ebb7c6"],
Cell[107996, 2813, 14706, 372, 1239, "Input",ExpressionUUID->"478b6824-841d-4677-9d3e-33106e4328d1"],
Cell[122705, 3187, 15557, 393, 1199, "Input",ExpressionUUID->"16b8b2f9-aaad-4475-989d-1bd4692e16ce"]
}, Open  ]],
Cell[CellGroupData[{
Cell[138299, 3585, 83, 0, 54, "Subsection",ExpressionUUID->"a19fc9ee-9563-4a89-8372-606547c33870"],
Cell[138385, 3587, 431, 12, 73, "Input",ExpressionUUID->"aab4b06c-a43c-47ae-af60-fdff533f24b2"],
Cell[138819, 3601, 2307, 57, 283, "Input",ExpressionUUID->"f9f80f51-587f-4373-b747-ae91f24982c4"],
Cell[141129, 3660, 154, 3, 30, "Input",ExpressionUUID->"09442f77-de8b-4de7-840e-c972682d3590"],
Cell[141286, 3665, 1060, 28, 136, "Input",ExpressionUUID->"e187fb82-54ee-49be-b2a1-35d20794faab"],
Cell[142349, 3695, 4126, 108, 472, "Input",ExpressionUUID->"66975706-fb8d-4dee-bc90-2ffbf6834ff3"],
Cell[146478, 3805, 8995, 229, 765, "Input",ExpressionUUID->"e0ea9c68-ce15-4aef-bada-23245c09d199"],
Cell[155476, 4036, 9039, 233, 679, "Input",ExpressionUUID->"24b490b0-8124-4917-ae2a-20b2efed7b51"],
Cell[164518, 4271, 6878, 175, 787, "Input",ExpressionUUID->"08b9de2d-835e-4e84-acf9-936c339443b1"],
Cell[171399, 4448, 15315, 376, 1027, "Input",ExpressionUUID->"784037ef-ad62-4978-9610-28ae6f4df14a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[186751, 4829, 85, 0, 54, "Subsection",ExpressionUUID->"6e553140-7a66-4632-b48b-e250a4b9679b"],
Cell[186839, 4831, 447, 12, 73, "Input",ExpressionUUID->"543d8f28-effe-4d70-b264-f2b4783bac9d"],
Cell[187289, 4845, 1906, 46, 241, "Input",ExpressionUUID->"62c172ad-23b6-4f60-9b94-12c95f2a21b5"],
Cell[189198, 4893, 9584, 246, 787, "Input",ExpressionUUID->"ae70b0b0-e5e2-48f5-a8db-d4a0b7d9da8f"],
Cell[CellGroupData[{
Cell[198807, 5143, 85, 0, 45, "Subsubsection",ExpressionUUID->"3938827d-1b1e-459f-9f11-0b3212fdd467"],
Cell[198895, 5145, 230, 5, 52, "Input",ExpressionUUID->"8286369a-e077-4ac5-84fc-320b7d8469c0"],
Cell[199128, 5152, 258, 6, 52, "Input",ExpressionUUID->"fa0c2c9b-76a8-4deb-940e-7f551a1f1454"],
Cell[199389, 5160, 10464, 254, 802, "Input",ExpressionUUID->"9c568c53-9ef9-4225-b027-4e8c5464ddbf"],
Cell[209856, 5416, 8161, 208, 885, "Input",ExpressionUUID->"8c70e40b-4d95-4331-b84e-6a3f70f2f64a"]
}, Closed]],
Cell[CellGroupData[{
Cell[218054, 5629, 86, 0, 37, "Subsubsection",ExpressionUUID->"8d119985-d768-4a0e-aec4-49a91cb85b3e"],
Cell[218143, 5631, 256, 6, 52, "Input",ExpressionUUID->"343305eb-5e63-4f00-8bc7-e811b13f9b38"],
Cell[218402, 5639, 258, 6, 52, "Input",ExpressionUUID->"688e2f3b-8c54-4f0c-920a-faa471f5cd5c"],
Cell[218663, 5647, 10523, 256, 802, "Input",ExpressionUUID->"6fc9d06d-183f-4665-b911-2e73c82ad8ae"],
Cell[229189, 5905, 8193, 210, 885, "Input",ExpressionUUID->"966d3d3c-19a1-4854-9f84-68e50feaa800"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[237431, 6121, 82, 0, 38, "Subsection",ExpressionUUID->"0d6aa187-8bc5-4171-a8d8-717cf13ac904"],
Cell[237516, 6123, 431, 12, 73, "Input",ExpressionUUID->"2ac064a6-91b5-4ab6-9568-16b843d6ebc5"],
Cell[237950, 6137, 4405, 102, 388, "Input",ExpressionUUID->"d736b68d-c847-470a-902c-18f0c5be7f3a"],
Cell[242358, 6241, 194, 5, 30, "Input",ExpressionUUID->"eb515612-0f02-4381-a0ab-55b2918aef12"],
Cell[242555, 6248, 147, 3, 30, "Input",ExpressionUUID->"72596cd4-4181-46c0-ab2a-433a66160832"],
Cell[242705, 6253, 3756, 97, 318, "Input",ExpressionUUID->"3e45f4ca-d836-4c9b-9a61-08705c3e101a"],
Cell[246464, 6352, 3971, 106, 262, "Input",ExpressionUUID->"e1844ae8-c134-4b82-b152-6200fd7faa72"],
Cell[250438, 6460, 2956, 77, 325, "Input",ExpressionUUID->"2c4e7230-b6f8-4d4e-9bff-d1ca239d3243"],
Cell[253397, 6539, 3219, 79, 325, "Input",ExpressionUUID->"86920e85-a2e2-4848-90aa-5a797c879cf2"]
}, Open  ]]
}, Open  ]]
}
]
*)

